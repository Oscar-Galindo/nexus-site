---
/**
 * Dynamic Page Route
 * Renders pages from Contentful based on slug (SSR mode)
 */

import BaseLayout from '@/layouts/BaseLayout.astro';
import Navigation from '@/components/global/Navigation.astro';
import SiteFooter from '@/components/global/SiteFooter.astro';
import SectionRenderer from '@/components/SectionRenderer.astro';
import { getPageBySlug } from '@/lib/contentful';

// Get slug from URL params
const { slug } = Astro.params;

// Fetch page from Contentful
const page = await getPageBySlug('/' + (slug || ''));

// 404 if page not found
if (!page) {
  return Astro.redirect('/404');
}

// Default footer content
const footerContent = {
  logoUrl: 'https://res.cloudinary.com/dhs9d8tou/image/upload/v1769829242/onmlogo_bhcbxa.png',
  tagline: 'Hand it off. It\'s handled.',
};
---

<BaseLayout title={page.title + ' | Online Nexus Marketing'}>
  
  <Navigation currentPath={'/' + slug} />

  {/* Render Hero Section first if present */}
  {page.heroSection && (
    <SectionRenderer section={page.heroSection} index={0} />
  )}

  {/* Then render other sections */}
  {page.sections.length === 0 && !page.heroSection ? (
    <section class="w-full pt-40 pb-24 px-6 md:px-12 bg-white text-black">
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="text-4xl md:text-6xl font-semibold mb-8">{page.title || page.name}</h1>
        <p class="text-xl text-neutral-500">Content coming soon...</p>
      </div>
    </section>
  ) : (
    page.sections.map((section, index) => (
      <SectionRenderer section={section} index={index + 1} />
    ))
  )}

  <SiteFooter
    logoUrl={footerContent.logoUrl}
    tagline={footerContent.tagline}
  />
</BaseLayout>
